language: node_js
node_js:
- 8
addons:
  postgresql: 9.5
  apt:
    packages:
    - postgresql-9.5-postgis-2.3
services:
- postgresql
jobs:
  include:
  - stage: Test
    script: yarn; yarn test
  - stage: Deploy
    script: yarn; yarn build
    deploy:
      provider: s3
      access_key_id: "$AWS_ACCESS_KEY_ID"
      secret_access_key: "$AWS_SECRET_ACCESS_KEY"
      bucket: "$S3_BUCKET"
      skip_cleanup: true
      local_dir: build
      acl: public_read
      on:
        all_branches: true
        condition: "$AWS_ACCESS_KEY_ID"
env:
  global:
  - secure: K9te+K9nuHtD0jGmUAYRIqdXM5aJgOE0zDxOyRDTdlbi71yM2a50GU1Q/SXr68ggG8dPLz38JmW+iFlqD/FMQc9e8bMnkjmzh7PmNPUkEn4OD8fllBhyGFa/91ln06RLlomX+iL3ZcljByyTVa4rIPZbJyXpCu51OzHFRxsSVlJ0Z7Cf+kmRDc0c+YD3NEaxbRtzEh39g5HGEmk66RR28YH5qe3FJVT7cjptzW3YOEyFw6KL8J0p5w+R+n8gIt44ihFPrtTbIdOvqD+2eaw5pz8TvK6Hjd4zQBq3m+A4jSaKLxT7P2h02C6L6Ye4jRGBClSKdVniPNNS7OJyRf5ILETW8aZfdThgxDMtlYU0w8imdGrlGAtHx7HANZtQfUQst9lqNh+FDBRd77vxlLC+CTqh6+O/NtvHK/0JT7Fdgt5x+juFOupG7EBfdS2Bs4FY0p/JuzLHaw54nH6yu2eV18SXbgDH1uE+01UdcMD2heLF/pCf0dNR3yumP6yG60N/ZPzaUXS+5hVlbp0pagKqck3tVbyQ/aRNp4Ws3oYgMcCwV/egzIThNe5PNtRyeHbEfVD69R9WBFbfdMmF4Dcw77n0m1plsxMeXP9Srq+ZRDxN85/3tPBxvDXc3qWh76oE6lBIbDm/55UWy13Oeztz++bOJIbfeRSbxhaJ/rtFUe8=
  - secure: FfQ3IC0JZ6fPusM9iaqhQm3mTg3btHGsAX27lZmqkJBIGeDsmu3HkwUgl4+E57FxhqZiDAjUxaxJN7lYaHmdGLflWJcOydVWe9uI0zkq1FwmExS2WowoJwo4DidxZ69y5VV5jwe5cYElxwEyzytgcwvwgkTKEDb519wWmGMRaknUJo7UO8gA7rSNWnt6JhwQq390IvR+V/bUs63j61BRoA/LuCO4G/1OyYUMBzQ7pKoXjm1VmMKWs6+AUOJs4MAk6jPgsX1o7tp11rfkEmBp3ZFU8F3PhcI0eA/zc3wzGH5MkjcVgiGTffhlp3T7GkXIcQAJ1vEcwsDlNnnd/raxLNA/29t74I4GdxxPSAZJBmuS/NJeJyTs8w3lI98AaU9BoNqgxm979DC1zA83KdTgrvjLm0wTLlYt6weF6YHSxXpIKiU2zGdfCViTwv165nJo+WNaCY8aKpxksIYOenn32fXg/0y/UbKoq/uwzbgA0vpmTf5qWyrDdgCQstAngHd98cIisMcSXTSu9N/0td4aFRVQNnArR24sP+H+yTBz0+bFtOG+l74s/bwDpwCOoF1VCeG90TDCMziAU3ET7b0kZkwT+dq25cCQabkvetKEbnzifj5R95ISRRz4JPEQ8LNzmtzCBJ9g1zm90CL4SnQvwkP32AHKB6lpirSZVkoxcUk=
  - CURRENT_FLOODS_BRANCH_NAME=split-out-backend
  - S3_BUCKET=ctxfloods-frontend-split-out-backend
  - REACT_APP_BACKEND_URL=https://2omhorg3mc.execute-api.us-east-1.amazonaws.com/dev
