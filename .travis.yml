language: node_js
node_js:
- 8
addons:
  postgresql: 9.5
  apt:
    packages:
    - postgresql-9.5-postgis-2.3
services:
- postgresql
script: yarn; yarn test;
script: yarn build;
deploy:
  provider: s3
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  bucket: "$S3_BUCKET"
  skip_cleanup: true
  local_dir: build
  acl: public_read
  on:
    all_branches: true
    condition: "$AWS_ACCESS_KEY_ID"
env:
  global:
  - secure: tlp+iqbWYvowdQogbvXGGeqv0/lz4QD8leBU85gMwuPAyva0JwGn4cyQP1979DjEa43FLzO0QPGrMiCb8gdXJg8akBclu9IHjBdF2pNQ+l5Xe52bvoJiKi+9DpdB+xDUufNfd6yjtUSlDwM1sVCyG516MBGZUZWYu5f+pM59c05zNOht9NwGia/3ZrF7NlmEJVXQ4m67QcfDSZCwsb1HqlWDmetmlpgPq3gRBlOy2K3/VtXps9KUvdpdYRIcfUlTqc0GziwG89R7AxYdIPo4aew13PwCNqdpe/D+c+p+d+Xah21sRn9N0OlQAXT7d96y29WtJQPxLEAjEeGtlm2hC0DmVmNDHbMypIQld8qgKgqZUyn/Decyr1haAgI52hYTrMqrFJtFY6FFA6iJ0U+CBgDF+4va/cFD68+FEC/JpuUlicFkMmGZUFAD6yj4PgaalM0WREvsTc2Eq7WngIsQEIXWM0aWVL4pUZSd6ZEfjKQ9grRSxA9bp6HHhQ2ZvfMa/8bylsbNPFN3L4bR2SobGBzdANUtmBY2BPSoqlbnryCVGsCe18hVOCXjHTkYAhL+yJDntNcUiBLT2VU/ZK4trURe4LjJLshCsLFMUz1IWx10wOdVX0BltDOP2jdpgBdVpuZWJEbIfnbYLcVFzUe90RmolyW5jK6jnsM5h4fyq7o=
  - secure: axpnUOo0PweenGAuUvCwJ4a3+AIpBwdKzybzl8YjvguojR3Ncz4MT9UqkP5L2sIxF3SQUQPHNJCi/oXhWmkEBQk9QtW+BRqGmQPylrPPOX6J0AvW/vb+fnj+D//aqEhzWfTcyCWkQWNgk9DhwWNywQ28pfMSUODOEJDOyIA6RYF8ia8euqyhGD9VzeF7NFRx5oop2poPeicXiSBma6vZK3AVBBtYAMKBP1SpFOcDQYQeIHiyK7vaKasNZ9ZMXGe3WYhi/QFR+72h6EeWXoPzpsN5IL6vZc8mox4PYr8ZpwNzPA6G+tUaDk2d/QF9guLhgcL4BUjGCTd3n4S/psXn2PXulgklRleuk4xxajKhtlGLUuisCl/wVUVQyyJ3LVdP/qJSksqHoLXwwD9I3Atwp1IuHx8sml+2NbDqDHxmIVj3NMXUvaG8VLt7FXKHDXTLpiOqRNABycTt4D82xnrZw6AUey8kfPB+o55JGsTE5cg61PwU8Nj04EagRMm31xQ507s6JApT2R9pqoz5xHDqdUC5B9UfNB7e5gxiitwHa6skQPa3Fxd6IakrGW2ln7PfD2qZSHJ+z9utJLchkyKjvyTFmokv/HbtUSa5nKBaGjBTqx10ZbUJsdL/ukfhvtd1Pk/89b6e4bjUHMHE68Ex3Dn3dgCee2Je3hyViWhyFfk=
  - CURRENT_FLOODS_BRANCH_NAME=split-out-backend
  - S3_BUCKET=ctxfloods-frontend-split-out-backend
  - REACT_APP_BACKEND_URL=https://2omhorg3mc.execute-api.us-east-1.amazonaws.com/dev
